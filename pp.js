HTTP/2 200 OK
Server: nginx/1.25.2
Date: Sun, 10 Sep 2023 19:41:52 GMT
Content-Type: text/html; charset=utf-8
Vary: Accept-Encoding
X-Page-Name: en/payment
X-From-Cache: False
Set-Cookie: user_image=; Path=/
Set-Cookie: user_id=Guest; Path=/
Set-Cookie: system_user=yes; Path=/
Set-Cookie: full_name=Guest%20Guest; Path=/
Set-Cookie: sid=Guest; Expires=Wed, 13-Sep-2023 22:41:52 GMT; Path=/
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Authorization,DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type
Via: 1.1 google
Alt-Svc: h3=":443"; ma=2592000,h3-29=":443"; ma=2592000

<script>
    window.frappe = {};
    frappe.ready_events = [];
    frappe.ready = function (fn) {
        frappe.ready_events.push(fn);
    };
    window.dev_server = 0;
</script>

<head>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-55L9KS');</script>
    <!-- End Google Tag Manager -->
    

    <!DOCTYPE html>

    <head>
        <meta charset="UTF-8">
        <meta name="generator" content="frappe">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
        <script type="text/javascript" src="/assets/js/frappe-web.min.js"></script>
        <script src="https://cdn.checkout.com/js/framesv2.min.js"></script>
        <title>فاتورة الطلب #N0BD82DA</title>

        <style>
            @font-face {
                font-family: 'expobook';
                src: url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.eot');
                src: url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.eot?#iefix') format('embedded-opentype'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.woff2') format('woff2'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.woff') format('woff'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.ttf') format('truetype'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-Book.svg#ExpoArabic-Book') format('svg');
                font-weight: normal;
                font-style: normal;
            }

            @font-face {
                font-family: 'expobold';
                src: url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.eot');
                src: url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.eot?#iefix') format('embedded-opentype'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.woff2') format('woff2'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.woff') format('woff'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.ttf') format('truetype'),
                    url('/assets/matajer/fonts/arabic-font/ExpoArabic-SemiBold.svg#ExpoArabic-SemiBold') format('svg');
                font-weight: 600;
                font-style: normal;
            }

            body,
            input {
                margin: 0 auto;
                width: 100%;
                font-family: "expobook", Helvetica, Arial, sans-serif;
                direction: ltr;
                text-align: left;
                font-size: 13px;
                background: #F7F7F7;
                max-width: 414px;
            }

            h1,
            h2,
            h3 {
                margin: 0;
            }

            h1 {
                font-size: 24px;
                margin: 0 0 16px 0;
            }

            #wrapper {
                padding: 0 16px 0 16px;

            }

            #wrapper>section h3 {
                font-size: 150%;
                font-weight: bold;
                margin-top: 10px;
                margin-bottom: 0;
            }

            #wrapper table {
                width: 100%;
                text-align: right;
            }

            #wrapper table th {
                font-weight: 300;
                color: #7b7b7b;
                width: 50%;
            }

            #wrapper table td {
                vertical-align: top;
            }

            .collapse {
                margin-bottom: 20px;
                background: #fff;
                border-radius: 8px;
                padding: 16px;
            }

            .collapse h3 {
                font-weight: normal;
                font-size: 11pt;
                margin-bottom: 15px;
                color: #757575;
            }

            .collapse img {
                float: left;
                padding-right: 10px;
            }

            .product {
                clear: both;
                display: flex;
                overflow: auto;
                margin-top: 5px;
                border-top: 1px solid #ececec;
                padding-top: 5px;
            }

            .image-wrapper {
                min-height: 70px;
            }

            .summary {
                padding: 20px;
                background: #fff;
                margin-top: 16px;
                border-radius: 8px;
            }

            .cellheader {
                float: left;
                height: 24px;
                background: #f3f3f3;
                width: 25%;
                line-height: 24px;
                padding-right: 2%;
            }

            .cellcontent {
                box-sizing: borderbox;
                float: left;
                height: 24px;
                background: #fff;
                width: 71%;
                line-height: 24px;
                margin-right: 2%;
                border-bottom: 1px solid #eee;
            }

            .row {
                margin-bottom: 3px;
            }

            div.orderinfo {
                width: 48%;
                font-size: 14px;
                margin-bottom: 20px;
                margin-top: 20px;
                float: left;
            }

            .tablerow {
                display: flex;
                justify-content: center;
                align-items: center;
                border-bottom: 1px solid #eee;
            }

            .productimage {
                width: 20%;
                float: left;
            }

            .productimage img {
                width: 60%;
                float: left;
            }

            .nameandprices {
                display: inline-block;
                width: 80%;
                float: left;
            }

            .productprices {
                margin-top: 10px;
            }

            .productprice {
                float: left;

            }

            .productqtyunit {
                width: 20%;
                float: left;
            }

            .productqtytotal {
                float: right;
                text-align: left;
                font-weight: bold;
                font-size: 18px;
            }

            .addressdetails {
                margin-top: 10px;
            }

            .paymentsection {
                border-radius: 8px;
                padding: 20px;
                background: #fff;
            }

            .reaminingtotal {
                font-family: expobold;
                font-size: 40px;
                text-align: center;
                margin-top: 8px;
                color: #5FB500;

            }

            .paymentmethod {
                border: 1px solid #e1e1e1;
                width: 100%;
                background: #fff;
                margin-right: 15px;
                margin-top: 16px;
                border-radius: 8px;
                overflow: hidden;
                margin-bottom: 0px;
            }

            .paymentmethod:last-child {
                margin-bottom: 0px;
            }

            .active {
                border: 1.5px solid #5FB500;

            }

            .generalInfo {
                color: #bdbdbd !important;
                font-size: 12px;
                text-align: left;
                margin-top: 20px;
            }

            .methods {
                width: 100%;
                margin: 0 auto;
            }

            #applepay,
            #madapayform,
            #cashbtn {
                display: none;
            }


            #madapayform {
                margin-top: 16px;
            }

            #madabtn,
            #cashbtn {
                margin-top: 16px;
            }

            .form-radio {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                display: inline-block;
                position: relative;
                background-color: #f1f1f1;
                color: #64B500;
                top: 10px;
                height: 24px;
                width: 24px;
                border: 0;
                border-radius: 50px;
                cursor: pointer;
                margin: 0 7px 0 0;
                outline: none;
                display: none;
            }

            .tipCheckbox {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                display: inline-block;
                position: relative;
                background-color: #f1f1f1;
                color: #64B500;
                top: 8px;
                height: 24px;
                width: 24px;
                border: 0;
                border-radius: 8px;
                cursor: pointer;
                margin: 0 0px 0 7px;
                outline: none;
            }

            input[type='radio']+label,
            input[type='checkbox']+label {
                font-family: 'expobook';
                line-height: 36px;
            }

            input[type='radio'] + label {
                font-family: 'expobook';
                line-height: 36px;
                padding: 8px;
                background: #f8f8f8;
                border-radius: 8px;
                border: 1.2px solid #f8f8f8;
            }

            .tipCheckbox:checked::before {
                position: absolute;
                font: 13px/1 'Open Sans', sans-serif;
                left: 8px;
                top: 4px;
                content: '\02143';
                transform: rotate(40deg);
            }

            .form-radio:hover,
            .tipCheckbox:hover {
                background-color: #f7f7f7;
            }

            .form-radio:checked,
            .tipCheckbox:checked {
                background-color: #64B500;
                color: #fff;
            }

            .form-radio:checked+label {
                border: 1.2px solid #64B500;
                background: #F3F9EB;
                font-weight: bold;
            }

            shoppertipvalueoptions.form-radio:checked+label,
            deliverymantipvalueoptions.form-radio:checked,
            charityvalueoptions.form-radio:checked {
                border: 1.2px solid #64B500;
                font-weight: bold;
            }

            label {
                font: 13px/1.7 'Open Sans', sans-serif;
                color: #333;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                cursor: pointer;
                margin-left: 4px;
            }


            .cashpayment {
                /*background: url(/assets/matajer/imgs/cashpay.png) 16px 28px no-repeat ;*/
                background-size: 70px;
                padding: 16px;
                box-sizing: border-box;
            }

            .madapayment {
                /*background: url(/assets/matajer/imgs/onlinepay.png) 16px 20px  no-repeat ;*/
                background-size: 70px;
                font-size: 16px;
                padding: 16px;
                box-sizing: border-box;
            }

            .applpaypayment {
                /* background: url(/assets/matajer/imgs/applepaypng.png) 16px 28px no-repeat ;*/
                background-size: 70px;
                font-size: 16px;
                padding: 16px;
                box-sizing: border-box;
                padding-bottom: 12px;
            }

            .paymentmethodtitle,
            .tiptitle {
                padding: 0;
                margin: 0;
                font-size: 15px;
                text-align: left;
                color: #000 !important;
            }

            .paymentmethodsubtitle {
                padding: 0;
                margin: 0;
                font-size: 12px;
                color: #757575;
                padding-top: 4px;
                width: 100%;
                padding-bottom: 10px;
                display: flex;
                align-items: flex-end;
            }

            .timer {
                font-family: "expobold";
                color: red;
            }

            #payment-form {
                width: 100%;
            }

            iframe {
                width: 100%;
                margin-top: 8px;
            }

            .one-liner {
                display: block;
                width: 100%;
            }

            #madapayform p,
            #cashbtn p {
                margin: 0;
                padding: 0;
                border-top: 1px dashed #e1e1e1;
                padding-top: 24px;
                padding-bottom: 8px;
                color: #303030;
                font-weight: normal;
                font-size: 13px;
            }


            #payment-form {
                margin-bottom: 0px;
            }

            .card-frame {
                border: solid 0px #e1e1e1;
                border-radius: 4px;
                width: 99.99%;
                margin-bottom: 16px;
                height: 44px;
                background: #F7F7F7;
            }

            .card-frame.frame--rendered {
                opacity: 1
            }

            .card-frame.frame--rendered.frame--focus {
                border: solid 1px #13395E;
                box-shadow: 0 2px 5px 0 rgba(19, 57, 94, 0.15)
            }

            .card-frame.frame--rendered.frame--invalid {
                border: solid 1px #D96830;
                box-shadow: 0 2px 5px 0 rgba(217, 104, 48, 0.15)
            }

            .success-payment-message {
                color: #13395E;
                line-height: 1.4
            }

            .token {
                color: #b35e14;
                font-size: 0.9rem;
                font-family: monospace
            }


            .collapsible {
                cursor: pointer;
                border: none;
                outline: none;
                font-size: 15px;
            }

            .collapse h3 {
                margin-bottom: 0;
            }

            .content {
                display: none;
                overflow: hidden;
                margin-top: 20px;
            }

            #pay-button,
            #cash-pay-button,
            #use-saved-button,
            #payBySavedCardBtn {
                width: 100%;
                height: 48px;
                background: #5FB500;
                border-radius: 4px;
                color: #fff;
                text-align: center;
                line-height: 48px;
                font-size: 16px;
                border: 0;
                cursor: default;
                margin-top: 20px;
                font-family: expobold;
            }

            #pay-button:disabled, #payBySavedCardBtn:disabled {
                background: #bdbdbd;
            }

            .exchange {
                font-size: 5pt !important;
                margin-bottom: 0px !important;

            }

            .paymentheader {
                overflow: auto
            }

            .pullleft {
                float: left
            }

            .pullright {
                float: right;
            }

            .tiplabel {
                width: 80%;
                line-height: 36px;
            }

            .tiplabel label {
                padding: 0;
                margin: 0
            }

            .tiplabel label span {
                display: block;
                padding: 0;
                margin: 0;
                font-size: 11px;
                color: #bdbdbd;
                line-height: 24px;
            }


            .deliverymantipvalue,
            .shoppertipvalue,
            .charityvalue {
                width: 100%;
                margin-top: 16px;
            }

            .deliverymantipvalue select,
            .shoppertipvalue select,
            .charityvalue select {
                height: 36px;
                font-size: 13px;
                border: 1px solid #ccc;
                background: #fff;
                width: 100%;
            }

            .tip {
                overflow: hidden
            }

            .tip h2 {
                margin-bottom: 16px;
            }

            .shoppertip {
                overflow: hidden;
                margin-bottom: 8px;
            }

            .currency {
                font-size: 10px;
            }

            .man {
                padding: 10px;
                color: gray;
            }

            .man-tips {
                padding: 10px;
                border-radius: 12px;
                /*border: 2px solid gray;*/
                background-color: #f8f8f8;
            }

            .tip-padding {
                padding-left: 10px;
                cursor: pointer;
                white-space: nowrap;
                width: 23%;
            }

            .tip-selected {
                border: 1px solid #6ab818;
                font-size: 18px;
                font-weight: bold;
                color: black;
                padding: 8px;
            }

            form {
                margin-block-end: 0
            }

            .fa {
                display: inline-block;
                font: normal normal normal 14px/1 FontAwesome;
                font-size: inherit;
                text-rendering: auto;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                color: #ffd54a;
                font-size: 25px;
                padding-right: 10px;
            }

            .alert {
                background-color: #DB2F2F;
                color: white;
                line-height: 23px;
            }

            .alert p {
                margin: 0;
            }

            input[type="tel"] {
                height: 44px;
                background: #fff;
                border: 1px solid #dedede;
                text-align: center;
                border-radius: 4px;
                font-size: 17px;
                outline: 0;
            }

            .tamara-section {}
            .tamara-section .paymentmethodtitle {
                font-size: 14px;
                font-weight: 500;
            }
            
            .tamara-section .cashpayment {
                padding: 22px 16px 16px 16px;
            }
            
            .tamara-section .paymentmethod{
                margin-top: 0px;
            }

            .mobile-input {
                position: relative;
                display: flex;
            }

            .phonePrefix {
                position: absolute;
                left: 0;
                top: 10px;
                display: flex;
                align-items: center;
                width: 115px;
                justify-content: space-evenly;
            }
            .phonePrefix span {
                font-size: 17px;
            }
            .phonePrefix img {
                padding: 0px;
                border-radius: 3px;
            }
            .tmaraSubmitBtn {
                background-color: #00AC05 !important;
                box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05) !important;
                border-radius: 40px !important;
                font-weight: 700;
                font-size: 18px !important;
            }
            .tmaraSubmitBtn:disabled {
                background-color: #bdbdbd !important;
            }
            #tamaraCash .infoIcon {
                background-color: #000;
                width: 10px;
                height: 10px;
                display: block;
                border-radius: 50%;
                font-size: 12px;
                display: inline-flex;
                justify-content: center;
                align-items: center;
                color: #fff;
                padding: 2px;
                font-weight: 900;
                margin: 0px 5px;
            }
            .tamara-section .new {
                width: 31px;
                height: 15px;
                position: relative;
                top: 19px;
                right: 0px;
                border-radius: 8px 0px;
                justify-content: center;
                display: flex;
                padding: 2px 8px;
                font-size: 12px;
                font-weight: 500;
                background: #C3FBC5;
                box-shadow: 0px 0px 14px rgb(195 251 197 / 62%);
                color: #028905;
            }

            .stepsWrapper {
                display: flex;
                align-items: center;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }

            .steps {
                display: flex;
                align-items: baseline;
                width: 85%;
            }

            .lineBetweenStps {
                border-top: .5px solid #E0DDDC;
                /* height: 1px; */
                width: 100%;

            }
            .tamaraPaymentStep {
                display: flex;
                align-items: center;
                flex-direction: column;
            }
            .stepNumber {
                width: 30px;
                height: 30px;
                border: 1px solid #00AC05;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 3px;
                line-height: 16px;
            }

            .stepTitle {
                text-align: center;
                font-size: 12px;
                line-height: 16px;
                color: #191919;
                white-space: nowrap;
            }

            .stepAmount {
                font-size: 12px;
                line-height: 16px;
                text-align: center;
                color: #00AC05;
                white-space: nowrap;
                margin: 4px 0px 0px;
            }


            .tmaraStepLabel {
                color: #191919;
                display: flex;
                align-items: center;
                font-size: 14px;
                font-weight: 400;
                margin: 0px !important;
            }

            .tmaraStepLabel input {
                margin: 0;
                width: 13px;
                height: 13px;
                border-radius: 50%;
                background-color: #d1d3d1;
                content: '';
                display: inline-block;
                visibility: visible;
                border: 2px solid white;
                margin: 0px 5px 0px 0px !important;
            }
            .tmaraStepLabel input:checked:after {
                width: 17px;
                height: 17px;
                border-radius: 50%;
                top: -2px;
                left: -2px;
                position: relative;
                background-color: #00AC05;
                content: '\2713';
                color: #fff;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
            }

            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                padding-top: 90px;
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%;
                overflow: auto;
                background-color: rgb(0,0,0);
                background-color: rgba(0,0,0,0.4);
            }
            .modal-content {
                background-color: #fefefe;
                margin: auto;
                border: 1px solid #888;
                max-width: 330px;
                border-radius: 18px;
                overflow: hidden;
                position: relative;
                direction: ltr !important;
                text-align: left;
            }
            
            .modal-content img {
                width: 100%;
            }

            .modal-content div {
                padding: 24px 24px 40px;
            }

            .modal-content div  div{
                display: flex;
                flex-direction: row;
                justify-content: start;
                align-items: center;
                padding: 0px;
            }
            .modal-content h1{
                letter-spacing: 0.5px;
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 10px;
            }
            .modal-content h4{
                letter-spacing: 0.5px;
                color: #191919;
                font-weight: 400;
                font-size: 14px;
                line-height: 20px;
                margin-top: 10px;
            }
            .modal-content div  div img{
                margin: 0px;
                width: 56px;
            }

            .modal-content div  div span{
               font-size: 14px;
            }

            .modal-content div  div i{
                font-size: 20px;
                color: #000;
                width: 35px;
            }
            .close {
                color: #000;
                float: right;
                font-size: 28px;
                position: absolute;
                top: 15px;
                left: 20px;
                font-weight: 100;
            }

            .close:hover,
            .close:focus,
            .modal_cvv-close:hover,
            .modal_cvv-close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }

            .modal_cvv {
                display: none;
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%;
                overflow: auto;
                background-color: rgba(0,0,0,0.4);
            }
            .modal_cvv-content {
                background-color: #fefefe;
                margin: auto;
                border: 1px solid #888;
                max-width: 385px;
                border-radius: 18px 18px 0px 0px;
                overflow: hidden;
                direction: ltr !important;
                text-align: left;
                position: fixed;
                left: 50%;
                transform: translateX(-50%);
                bottom: 0;
                width: 100%;
            }

            .modal_cvv-content div {
                padding: 0px 16px 40px;
            }

            .modal_cvv-content div  div{
                display: flex;
                flex-direction: row;
                justify-content: start;
                align-items: center;
                padding: 0px;
            }
            .modal_cvv-content h1{
                letter-spacing: 0.5px;
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 0px;
            }
            .modal_cvv-content p{
                font-weight: 400;
                font-size: 14px;
                margin-bottom: 0px;
                color: rgba(25, 25, 25, 0.8);
            }
            .modal_cvv-content div  div img{
                margin: 0px;
                width: 62px;
            }

            .modal_cvv-close {
                color: #000;
                float: right;
                font-size: 28px;
                position: absolute;
                top: 15px;
                right: 31px;
                font-weight: 100;
            }


            #tamaraSubTitle {
                padding-bottom: 0px !important; 
                font-weight: 400;
                font-size: 12px;
            }

            .tamaraImg {
                display:block; 
                width: 52px; 
                margin-top: 8px;
                padding: 0px;
            }

            .tmaraStepContainer {
                /* border: 1px solid #f1f1f1;  */
                margin: 10px 0px; 
                border-radius: 4px; 
                padding: 10px;
            }

            .rememberCard{
                display: flex;
                flex-direction: column;

            }
            .rememberCard__action{
                display: flex;
                justify-content: space-between;
                align-items: center;
                width: 100%;
            }
            .ememberCard__disc{
                color: #757271;
                font-weight: 400;
                font-size: 10px;
                line-height: 16px;
            }

            .savedCard__view{
                display: flex;
                padding: 4px 10px 0px;
                position: relative;
                align-items: center;
                justify-content: start;
                width: 100%;
            }
            .savedCard__wrapper{
                position: absolute;
                width: 100%;
                height: 100%;
                background-color: green;

            }
            .savedCard__disc{
                color: #B0ADAB;
                font-weight: 400;
                font-size: 10px;
                line-height: 16px;
                padding: 5px 10px;
                text-align: center;
            }
            .switch {
                position: relative;
                display: inline-block;
                width: 36px;
                height: 20px;
            }
            .switch input {
                width: 0px;
                height: 0px;
                visibility: hidden;
                width: auto;
                margin: 0px;
            }
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                -webkit-transition: .4s;
                transition: .4s;
            }
            .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 18px;
                bottom: 2px;
                background-color: white;
                transition: .4s;
            }
            input:checked+.slider {
                background-color: #34C759;
            }
            input:focus+.slider {
                background-color: #34C759;
            }
            input:checked + .slider:before  {
                left: calc(100% - 18px);
                transform: translateX(-100%);
            } 
            .slider.round {
                border-radius: 34px;
                transform: rotatey(180deg);
            }
            .slider.round:before {
                border-radius: 50%;
            }


            .saved-card-section{
                display: flex;
                flex-direction: column;

            }
            .saved-card-row {
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 8px 16px;
                border-radius: 4px;

            }

            .saved-card-row div {
                display: flex;
                align-items: center;
            }
            .saved-card-row div input {
                margin: 0;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background-color: #d1d3d1;
                content: '';
                display: inline-block;
                visibility: visible;
                border: 2px solid white;
            }
            .saved-card-row div input:checked:after {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                top: -6px;
                left: -6px;
                position: relative;
                background-color: #00AC05;
                content: '\2713';
                color: #fff;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
            }
            .saved-card-row div input:checked {
                width: 5px;
                height: 5px;
            }
            .deleteExpiredCard {
                border: none;
                margin: 0px;
                padding: 0px;
                cursor: pointer;
            }
            .deleteExpiredCard img {
                padding: 0px;
            }
            .radioSelected{
                background: rgba(0, 172, 5, 0.1);
            }
            .visaDetails {
                display: flex;
                flex-direction: column;
                align-items: start;
            }
            .dot {
                height: 5px;
                width: 5px;
                background-color: #191919;
                border-radius: 50%;
                display: inline-block;
                margin: 2px;
            }
            .loader {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                display: block;
                margin:15px auto;
                position: relative;
                color: green;
                left: -100px;
                box-sizing: border-box;
                animation: shadowRolling 2.5s linear infinite;
            }

            @keyframes shadowRolling {
                0% {
                    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
                }
                12% {
                    box-shadow: 100px 0 green, 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
                }
                25% {
                    box-shadow: 110px 0 green, 100px 0 green, 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
                }
                36% {
                    box-shadow: 120px 0 green, 110px 0 green, 100px 0 green, 0px 0 rgba(255, 255, 255, 0);
                }
                50% {
                    box-shadow: 130px 0 green, 120px 0 green, 110px 0 green, 100px 0 green;
                }
                62% {
                    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 green, 120px 0 green, 110px 0 green;
                }
                75% {
                    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 green, 120px 0 green;
                }
                87% {
                    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 130px 0 green;
                }
                100% {
                    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
                }
            }

            #loaderSection {
                display: flex;
                justify-content: center;
            }

            #savedCardCvvContainer {
                margin-left: 28px;
            }

            #savedCardCvvContainer .savedCardCvvInput{
                border-radius: 4px;
                background-color: #FFF;
                width: 95px;
                height: 36px;
                padding: 8px 16px;
                position: relative;
                border: 1px solid #E0DDDC;
                outline-color:#00AC05;
                font-size: 14px;
            }

            #savedCardCvvContainer .savedCardCvvInput:focus {
                border: 1px solid #00AC05;
            }

            .showCvv {
                display: none !important;
            }

            [name=savedCard]:checked ~ .savedCard__view > .showCvv {
                display: block !important;
            }
            .cvvInfoIcon {
                position: absolute;
                top: 15px;
                right: 10px;
                width: 13px;
                cursor: pointer;
            }

        </style>


        <script>
            var shopper_tips = 0;
            var delivery_tips = 0;
            var charity = 0;
            var total = parseFloat("395.0");
            var max_limit_Pay_next_month = 0;
            var max_limit_plit_multiple_payments = 0;
            var is_tamara_show = false;
            var cvv_value = '';

            function showmadapay() {
                document.getElementById('madapayform').style.display = "block";
                if (document.getElementById('applepay1')) {
                    document.getElementById('applepay').style.display = "none";
                    document.getElementById('applepay1').classList.remove('active');
                }

                if ("False") {
                    if (document.getElementById('tamaraCashbtn')){
                        // document.getElementById('tamaraSubTitle').style.display = "block";
                        document.getElementById('tamaraCashbtn').style.display = "none";
                        document.getElementById('tamaraCash').classList.remove('active');
                    }
                }

                document.getElementById('cashbtn').style.display = "none";
                document.getElementById('mada').classList.add('active');
                document.getElementById('cash').classList.remove('active');

                //send ruddarstack click event
                let payment_method = "PYM00000007";
                send_ruddar_stack_click_event(payment_method)
                is_tamara_show = false;
            }

            function showapplepay() {
                if (document.getElementById('madapayform')) {
                    document.getElementById('madapayform').style.display = "none";
                    document.getElementById('mada').classList.remove('active');
                }

                if ("False") {
                    if (document.getElementById('tamaraCashbtn')){
                        // document.getElementById('tamaraSubTitle').style.display = "block";
                        document.getElementById('tamaraCashbtn').style.display = "none";
                        document.getElementById('tamaraCash').classList.remove('active');
                    }
                }

                document.getElementById('applepay').style.display = "block";
                document.getElementById('cashbtn').style.display = "none";
                document.getElementById('applepay1').classList.add('active');
                document.getElementById('cash').classList.remove('active');

                //send ruddarstack click event
                let payment_method = "PYM00000006";
                send_ruddar_stack_click_event(payment_method)
                is_tamara_show = false;
            }

            function showcashbtn(is_cache_form = true) {
                if (document.getElementById('madapayform')) {
                    document.getElementById('madapayform').style.display = "none";
                    document.getElementById('mada').classList.remove('active');
                }

                if (document.getElementById('applepay1')) {
                    document.getElementById('applepay').style.display = "none";
                    document.getElementById('applepay1').classList.remove('active');
                }

                if ("False") {
                    if (document.getElementById('tamaraCashbtn')){
                        // document.getElementById('tamaraSubTitle').style.display = "block";
                        document.getElementById('tamaraCashbtn').style.display = "none";
                        document.getElementById('tamaraCash').classList.remove('active');
                    }
                }

                document.getElementById('cashbtn').style.display = "block";
                document.getElementById('cash').classList.add('active');

                //send ruddarstack click event
                let payment_method = (is_cache_form) ? "{{ cash_payment_method_id }}" : "PYM00000009";
                send_ruddar_stack_click_event(payment_method)
                is_tamara_show = false;
            }

            function showTamarabtn() {
                if (document.getElementById('madapayform')) {
                    document.getElementById('madapayform').style.display = "none";
                    document.getElementById('mada').classList.remove('active');
                }

                if (document.getElementById('applepay1')){
                    document.getElementById('applepay').style.display = "none";
                    document.getElementById('applepay1').classList.remove('active');
                }

                if (document.getElementById('cashbtn')){
                    document.getElementById('cashbtn').style.display = "none";
                    document.getElementById('cash').classList.remove('active');
                }

                document.getElementById('tamaraCashbtn').style.display = "block";
                document.getElementById('tamaraSubTitle').style.display = "none";
                document.getElementById('tamaraCash').classList.add('active');
                handleSelectTmaraSteps()
                is_tamara_show = true;
            }

            function apple_payment_started_event() {
                let payment_method = "PYM00000006";
                frappe.call({
                    type: "POST",
                    method: "matajer.utils.ruddarstack_center.payment_started_event",
                    args: {
                        dataEntered: "order payment with Apple Pay",
                        order_id: "1orepIab",
                        store_id: "STR00000476",
                        payment_method_id: payment_method,
                        step: 1,
                        platform: "ANDROID"
                    }
                });
            }

            function send_ruddar_stack_click_event(method_id) {
                frappe.call({
                    type: "POST",
                    method: "matajer.utils.ruddarstack_center.payment_method_clicked",
                    args: {
                        order_id: "1orepIab",
                        store_id: "STR00000476",
                        payment_method_id: method_id,
                        platform: "ANDROID"
                    }
                });
            }

            function send_ruddar_stack_remember_card_event() {
                var isRememberCard = document.getElementById("switchBtn");
                console.log('ruddar_stack_remember_card_event is call')
                frappe.call({
                    type: "POST",
                    method: "matajer.utils.ruddarstack_center.save_card_btn_clicked",
                    args: {
                        order_id: "1orepIab",
                        customer_id: "d591fe8444@nana.sa",
                        action: isRememberCard && isRememberCard.checked ? '1' : '0',
                    }
                });
            }
            
            function submit_rajhi_pay(){
                var lang = "en";
                var order_id = "N0BD82DA";
                document.getElementById('rajhi_pay_id').style.pointerEvents = 'none';
                var img = document.createElement("IMG");
                img.src = "/assets/matajer/imgs/please_wait.jpg";
                img.style= "display:block; width: 100%; height:50%;"
                var oldImg = document.getElementById('rajhi-img');
                document.getElementById('rajhi_pay_id').replaceChild(img, oldImg);
                //send ruddarstack click event
                let payment_method="{{ rajhi_method_id }}";
                send_ruddar_stack_click_event(payment_method);
                frappe.call({
                    type: 'POST',
                    method: 'matajer.rajhi.validate_payment.handle_rajhi_pay',
                    args: {
                        'language': lang,
                        "order_id": order_id,
                        "shopper_tips": shopper_tips,
                        "delivery_tips": delivery_tips,
                        "charity":charity
                    },
                    callback: function (r) {
                        if (r) {
                            console.log(r);
                            if (r.message.error) {
                                alert('خطأ في الدفع: ' + r.message.error);
                            } else {
                                document.location.href = r.message.payment_url
                            }
                        }
                    }
                });
            }

            function deliverymanClick($div) {
                $(".deliveryman").each(function () {
                    $(this).removeClass('tip-selected');
                });
                $($div).addClass('tip-selected');
                delivery_tips = parseInt($($div).attr('value'));
                calc_tips();
            }

            function shoppperClick($div) {
                $(".shopper").each(function () {
                    $(this).removeClass('tip-selected');
                });
                $($div).addClass('tip-selected');
                shopper_tips = parseInt($($div).attr('value'));
                calc_tips();
            }
            
            function charityClick($div) {
                $(".charity").each(function () {
                    $(this).removeClass('tip-selected');
                });
                $($div).addClass('tip-selected');
                charity = parseInt($($div).attr('value'));
                calc_tips();
            }
            
            function calc_tips() {
                var tips = shopper_tips + delivery_tips + charity;
                $(".calc_total").html(total + tips + " SAR");
                $("#shopper_details_tips").html("");
                $("#delivery_details_tips").html("");
                $("#charity_details_tips").html("");
                $("#delivery_tips_input,#stc_delivery_tips,#rajhi_delivery_tips").val(delivery_tips);
                $("#shopper_tips_input,#stc_shopper_tips,#rajhi_shopper_tips").val(shopper_tips);
                $("#charity_tips_input,#stc_charity_tips,#rajhi_charity_tips").val(charity);
                if (shopper_tips > 0) {
                    $("#shopper_details_tips").html('<td>شكراً للمتسوق</td><td>' + shopper_tips + '</td>')
                }
                if (delivery_tips > 0) {
                    $("#delivery_details_tips").html('<td>شكراً للموصل</td><td>' + delivery_tips + '</td>')
                }
                if (charity > 0) {
                    $("#charity_details_tips").html('<td> تبرع </td><td>' + charity + '</td>')
                }

                if('False' === 'True' && is_tamara_show){
                    handleTamaraDonate(tips);
                }
            }

            function get_tamara_installment_options(payment_type, num_installment){
                let tamara_data = JSON.parse('{{ tamara_options_json }}');
                pay_options = []
                $.each(tamara_data, function(k, v){
                    if ( v['name'] === 'PAY_NEXT_MONTH') {
                        max_limit_Pay_next_month = v['max_limit']['amount'];
                    }

                    if ( v['name'] === 'PAY_BY_INSTALMENTS') {
                        max_limit_plit_multiple_payments = v['max_limit']['amount'];
                    }

                    if (v['name'] == payment_type){
                        if(payment_type == 'PAY_NEXT_MONTH'){
                            pay_options = v['payments']
                        }else{
                            $.each(v['supported_instalments'], function(ky, vl){
                                if(vl['instalments'] == num_installment){
                                    pay_options = vl['payments']
                                }
                            });
                        }
                    }
                });
                return pay_options;
            }

            function handleSelectTmaraSteps( total= 0 ) {
                let activeTamaraEle = $('#tamaraCashbtn input[type=radio]:checked')
                let tamara_type = activeTamaraEle.val()
                let total_donate = (delivery_tips + shopper_tips + charity )|| total;
                let total_installments = parseInt(activeTamaraEle.attr('data-installments'))
                let list = get_tamara_installment_options(tamara_type, total_installments);
                $(`#tamaraAction`).remove();
                activeTamaraEle.parent().parent().append(`<div id="tamaraAction">
                    <div class="stepsWrapper">
                        <div class="steps">
                            ${list.map((item, i) => `
                                <div class="tamaraPaymentStep">
                                    <span class="stepNumber">${i+1}</span>
                                    <span class="stepTitle">${getDayMonthFormate(item['date'])}</span>
                                    ${tamara_type == "PAY_NEXT_MONTH" && i == 1 ? `<span class="stepAmount">SAR ${item['amount'] + total_donate}</span>` : `${tamara_type == "PAY_NEXT_MONTH" ? `<span class="stepAmount">SAR ${item['amount']}</span>` : ''} `}
                                    ${tamara_type == "PAY_BY_INSTALMENTS" ? `<span class="stepAmount">SAR ${item['amount'] + (total_donate/total_installments)}</span>` : '' }
                                </div>
                                ${(i != list.length-1) ? '<div class="lineBetweenStps"></div>': ''}
                            `).join('')}
                        </div>
                    </div>
                    <form class="exchange" method="POST" action="https://nana.sa/api/method/matajer.orders.doctype.orders.order_payment.tamara_handling_service.tamara_create_session">
                        <input type='hidden' name="payment_type" value="${ tamara_type }">
                        <input type='hidden' name="instalments" value='${ total_installments }'>
                        <input type='hidden' name="order_id" value='N0BD82DA'>
                        <input type='hidden' name="store_name" value='نعناع بطاقات'>
                        <input type='hidden' name="lang" value="en_US">
                        <input type="text" name="delivery_tips_input" value="${ delivery_tips }" id="stc_delivery_tips" hidden>
                        <input type="text" name="shopper_tips_input" value="${ shopper_tips }" id="stc_shopper_tips" hidden>
                        <input type="text" name="charity_tips_input" value="${ charity }" id="stc_charity_tips" hidden>
                        <input type="submit" class="tmaraSubmitBtn" id="cash-pay-button" value="Continue" onClick="this.form.submit(); this.disabled=true; this.value='Sending…';"/>
                    </form>
                </div>`);
            }

            function handleValueChange(value) {
                if (value.length) {
                    $( ".tmaraSubmitBtn" ).prop( "disabled", false );
                }
                else {
                    $( ".tmaraSubmitBtn" ).prop( "disabled", true );
                }
            }

            function getDayMonthFormate(value) {
                if (value === 'Pay Today') {
                    return value;
                }
                let month_names = [
                    'January',
                    'February',
                    'March',
                    'April',
                    'May',
                    'June',
                    'July',
                    'August',
                    'September',
                    'October',
                    'November',
                    'December'
                ];
                let newDate = new Date(value) 
                if (newDate) {
                    let day = new Date(newDate).getDate();
                    let month = new Date(newDate).getMonth();
                    return `${day} ${month_names[month]}`;
                }
            }

            function handleTamaraDonate(total_tips){
                handleSelectTmaraSteps(total_tips)
                if( (total + total_tips) > max_limit_Pay_next_month ) {
                    document.getElementById('tmaraStepContainer_pay_next_month').style.display = "none";
                } else {
                    document.getElementById('tmaraStepContainer_pay_next_month').style.display = "block";
                }

                if( (total + total_tips) > max_limit_plit_multiple_payments ) {
                    document.getElementById('tmaraStepContainer_split_multiple_payments').style.display = "none";
                } else {
                    document.getElementById('tmaraStepContainer_split_multiple_payments').style.display = "block"; 
                }

                if( ((total + total_tips) > max_limit_Pay_next_month) && ((total + total_tips) > max_limit_plit_multiple_payments) ) {
                    document.getElementById('tamaraCashbtn').style.display = "none";
                    document.getElementById('tamaraCash').classList.remove('active');
                    document.getElementById('tamara_section').style.display = "none";
                } else {
                    document.getElementById('tamara_section').style.display = "block";
                    document.getElementById('tamaraCashbtn').style.display = "block";
                    document.getElementById('tamaraCash').classList.add('active');
                }
            }

            function handleSelectSavedCard(e) {
                $('#savedCardRow input:radio').change(function() {
                    $('div.radioSelected').removeClass('radioSelected');
                    $(this).closest('.saved-card-row ').addClass('radioSelected');
                    $('.savedCardCvvInput').val('');
                });
                
                // if($(e).prop("checked")){
                //    $("#payBySavedCardBtn").removeAttr('disabled')
                // }

                $( "#payBySavedCardBtn" ).prop( "disabled", true );

                document.getElementById('cardDetails-lable').style.display = "block";
                if(e.value=='addNewCard'){
                    document.getElementById('payBySavedCardBtn').style.display = "none";
                    document.getElementById('payment-form').style.display = "block";
                    document.getElementById('addCardWithRemember').style.display = "block";
                    document.getElementById('rememberCard-action').style.display = "block";
                    document.getElementById('payBySavedCardBtn').innerHTML = 'Pay Now';
                }else{
                    document.getElementById('payBySavedCardBtn').style.display = "block";
                    document.getElementById('addCardWithRemember').style.display = "none";
                    document.getElementById('cardDetails-lable').style.display = "none";
                }
            }

            function handleDeleteExpiredCard(e) {
                let customer_id = e.getAttribute("name");
                console.log(customer_id,'customer_id')
                frappe.call({
                    type: 'DELETE',
                    method: 'matajer.orders.doctype.orders.order_payment.checkout_handling_service.delete_customer_saved_card',
                    args: {
                        "customer_card_id": customer_id
                    },
                    callback: function (r) {
                        console.log('callBack is call', {r});
                        if (r.message === 'ok') {
                            console.log(r);
                            handleUseSavedCard();
                            if (r.message.error) {
                                alert('خطأ في الدفع: ' + r.message.error);
                            }
                        }
                    }
                });
            }

            function handlePayBySavedCardBtn(e) {
                document.getElementById('payBySavedCardBtn').innerHTML = 'Sending...';
                var card_token = $("input[type='radio'].savedCardRadioInput:checked").val();
                var lang = "en";
                var order_id = "N0BD82DA";
                var order_hash = "1orepIab";
                frappe.call({
                    type: 'POST',
                    method: 'matajer.orders.doctype.orders.order_payment.checkout_handling_service.handle_checkout_token',
                    args: {
                        'token': card_token,
                        'language': 'en',
                        "order_id": order_id,
                        "order_hash": order_hash,
                        "shopper_tips": shopper_tips,
                        "delivery_tips": delivery_tips,
                        "charity": charity,
                        "save_card": 'no',
                        "new_payment": 'no',
                        "cvv": cvv_value
                    },
                    callback: function (r) {
                    if (r) {
                        if (r.message.success) {
                            window.location.replace(r.message.success);
                        } else {
                            window.location.replace("http://nana.sa/en/payment_failed/?order_hash=1orepIab");
                        }
                    }
                    document.getElementById('payBySavedCardBtn').innerHTML = 'Pay Now';
                    }
                });
            }

            function handleUseSavedCard() {
                if("False" !== 'True'){
                    return
                }
               console.log('use saved card')
               var order_id = "N0BD82DA";
               frappe.call({
                    type: 'GET',
                    method: 'matajer.orders.doctype.orders.order_payment.checkout_handling_service.get_customer_saved_cards',
                    args: {
                        "order_id": order_id,
                    },
                    callback: function ({message}) {
                        if (message) {
                            if (message.error) {
                                alert('خطأ في الدفع: ' + message.error);
                                document.getElementById('savedCardSection').style.display = "none";
                                document.getElementById('savedCards-lable').style.display = "none";
                            } else {
                                document.getElementById('savedCardSection').style.display = "block";
                                document.getElementById('savedCards-lable').style.display = "block";
                                document.getElementById('cardDetails-lable').style.display = "none";
                                // document.getElementById('hasSavedCardsView').style.display = "none";
                                document.getElementById('addCardWithRemember').style.display = "none";
                                document.getElementById('loaderSection').style.display = "none";

                                let htmlString = '';
                                Frames.init({
                                    publicKey: 'Bearer pk_ckjh3jzg4izdokkes7i6ms4av42',
                                    localization: {
                                        cardNumberPlaceholder: 'Card number',
                                        expiryMonthPlaceholder: 'MM',
                                        expiryYearPlaceholder: 'YY',
                                        cvvPlaceholder: 'CVV',
                                    },
                                });
                                for (let i = 0; i < message.length; i++) {
                                    htmlString += `<div class="saved-card-row">
                                        <div>
                                            <input type="radio" class="savedCardRadioInput"  name="savedCard" value="${message[i].card_token}" id="savedCardRadio-${i}" onclick="handleSelectSavedCard(this)" ${isExpiredCard(message[i].expiry_month, message[i].expiry_year) ? 'disabled': ''} ${(!isExpiredCard(message[i].expiry_month, message[i].expiry_year) && i==0) ? 'checked' : ''} />

                                            <div class="savedCard__view">
                                                ${message[i].scheme && message[i].scheme.toLowerCase() == "visa" ? '<img src="/assets/matajer/imgs/visaIcon.png"/>' :
                                                message[i].scheme && message[i].scheme.toLowerCase()  == "mastercard" ? '<img src="/assets/matajer/imgs/master-icon.png"/>' :
                                                message[i].scheme && message[i].scheme.toLowerCase() == "amex" ? '<img src="/assets/matajer/imgs/amex-icon.png"/>' :
                                                '<img src="/assets/matajer/imgs/mada-icon.png"/>'}

                                                <div class="visaDetails">
                                                    <div style="font-size: 16px;font-weight: 600; display: flex; align-items: center; align-self: start; color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#B0ADAB' : '#191919'}">
                                                        <span class="dot" style="background-color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#B0ADAB' : '#191919'}"></span>
                                                        <span class="dot" style="background-color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#B0ADAB' : '#191919'}"></span>
                                                        <span class="dot" style="background-color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#B0ADAB' : '#191919'}"></span>
                                                        <span class="dot" style="background-color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#B0ADAB' : '#191919'}"></span>
                                                        <span style="margin-left: 4px;">${message[i].last4}</span>
                                                    </div>
                                                    <span style="font-size: 12; color: ${isExpiredCard(message[i].expiry_month, message[i].expiry_year)? '#ff902a' : 'darkgray'}"> ${isExpiredCard(message[i].expiry_month, message[i].expiry_year) ? 'Expired on' : 'Expires on'} ${message[i].expiry_month}/${message[i].expiry_year.toString().substr(2, 2)}</span>
                                                </div>
                                               <div id="savedCardCvvContainer" class="showCvv">
                                                    <input placeholder="CVV" type="text" id="savedCardCvv" class="savedCardCvvInput" name="savedCardCvv" onkeyup="handleCvvInput(this)" oninput="this.value = this.value.replace(/[a-zA-Z|!@#$%^&,*.\-]/g, '');"  maxlength="3" />
                                                    <img class="cvvInfoIcon" id="cvvInfo" onclick="handleOpenModal('cvv_modal','cvvInfo')" src="/assets/matajer/imgs/info_icon.svg"/>
                                                </div>
                                            </div>
                                        </div>
                                       ${isExpiredCard(message[i].expiry_month, message[i].expiry_year) ? `
                                        <a
                                            class="deleteExpiredCard" 
                                            id="delExpiredCard" 
                                            onclick="handleDeleteExpiredCard(this);" name="${message[i].name}">
                                            <img src="/assets/matajer/imgs/deleteIcon.svg"/>
                                        </a>`: ''}
                                    </div>
                                    `
                                }
                                htmlString += `<div style="border-top: 1px dashed #e1e1e1; padding: 10px 0px 0px;">
                                    <div class="saved-card-row" >
                                        <div>
                                            <input type="radio" name="savedCard" value="addNewCard" id="newCardCheckbox" onclick="handleSelectSavedCard(this)"/>
                                            <div class="savedCard__view">
                                                <img src="/assets/matajer/imgs/newCardIcon.png">
                                                <span style="font-size: 14px;">New card</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>`
                                document.getElementById('savedCardRow').innerHTML = htmlString;
                            }
                        }
                    }
                });
            };

            function isExpiredCard(expiry_month, expiry_year) {
                return Boolean(new Date().getFullYear() > expiry_year || new Date().getMonth()+1 > expiry_month && new Date().getFullYear() >= expiry_year)
            }

            function handleCvvInput(e){
                cvv_value = e.value
                if (cvv_value.length === 3) {
                    $( "#payBySavedCardBtn" ).prop( "disabled", false );
                }
                else {
                    $( "#payBySavedCardBtn" ).prop( "disabled", true );
                }
            }

            handleUseSavedCard();
        </script>

    </head>

<body>
    <div id="wrapper">
        <div class="generalInfo" style="width: 50%; float: right; text-align: right">
            <img src="/assets/matajer/imgs/secureen.svg" width="80%" style="text-align: right;">
        </div>
        <div class="generalInfo" style="width: 50%; float: left; text-align: left">
            <h1><span style="font-size: 11px;">Order ID</span><br>#N0BD82DA</h1>
        </div>
        <br style="clear: both">
    </div>

    <!-------------------------------------------------------------------------------------------------------------------------------------------------->

    <div class="collapse remaining">
        <span style="text-align: center; display: inline-block;width: 100%; margin-top:20px">Remaining to Pay</span>
        <h1 class="reaminingtotal calc_total">
            <script>$(".reaminingtotal").html("SAR " + total)</script>
        </h1>
        <!--             <p style="text-align: center">يرجى اتمام الدفع خلال <span class="timer">12 : 45 : 55 </span></p>-->
    </div>
    

    <!-------------------------------------------------------------------------------------------------------------------------------------------------->

    
    <!-- ==================== start of collapse methods section ====================== -->
    <div class="collapse">
        <h3>Choose Payment Method</h3>
        <!-- ==================== start of methods section ====================== -->
        <div class="methods">
            

            <!-- ==================== start of apple_pay section ====================== -->
            
            <div class="paymentmethod applpaypayment" id="applepay1" onclick="showapplepay()">
                <div class="paymentheader">
                    <p class="paymentmethodtitle">Apple Pay</p>
                    <p class="paymentmethodsubtitle">Pay order value using Apple Pay</p>
                    <img src="/assets/matajer/imgs/applepayicon.svg" style="display:block; height:32px;">
                </div>
                <div class="applepay" id="applepay">
                    <div style="margin-top:20px;">
                        <div onclick="javascript:startApplePaySession()" id="applePayC" class="applePayButtonContainer">
                            <a id="applePay" lang="us" class="applePayButton"
                                style="display: block;-webkit-appearance: -apple-pay-button; -apple-pay-button-type: plain; -apple-pay-button-style: black; height: 48px; width: 100%; margin: auto"
                                title="Start Apple Pay" role="link" tabindex="0"></a>
                        </div>
                        <div id="toappend"></div>
                        <p style="display:none" id="success">Test transaction completed</p>
                        <div id="fulllogdiv">
                            <section id="declarations" class="section">
                                <pre readonly="" id="fulllog"></pre>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ==================== end of apple_pay section ====================== -->

            <!-- ==================== start of rajhi section ====================== -->
            
            <!-- ==================== end of rajhi section ====================== -->

            <!-- ==================== start of cash section ====================== -->
            
            <div id="cash"></div>
            
            <!-- ==================== end of cash section ====================== -->

            <!-- ==================== start of mada_online section ====================== -->
            
            <div class="paymentmethod madapayment" id="mada" onclick="showmadapay()">
                <div class="paymentheader">
                    
                    <p class="paymentmethodtitle">We only accept Saudi payment cards.</p>
                    
                    <p class="paymentmethodsubtitle">Pay using Via, MasterCard, American Express, or Mada Card </p>
                    <img src="/assets/matajer/imgs/onlinepayments.svg" style="display:block; height: 24px;">
                </div>
                <div id="madapayform">
                    
                        <p id="cardDetails-lable">Card Details</p>
                        <form id="payment-form" method="POST" action="https://merchant.com/charge-card">
                            <div class="one-liner" id="addCardWithRemember">
                                <div class="card-frame">
                                    <!-- form will be added here -->
                                </div>
                                
                                <section class="rememberCard" id="rememberCard-action" style="display: block;">
                                    <div class="rememberCard__action">
                                       <span style="font-size: 14px;">Remember this Card</span>
                                       <label class="switch" for="switchBtn">
                                            <input type="checkbox" id="switchBtn"  value="{{ toggelCheckbox }}" checked>
                                            <span class="slider round"></span>
                                      </label>
                                    </div>
                                       <span class="ememberCard__disc">Card details will be securely saved for a faster payment experience</span>
                                </section>
                                
                                <!-- add submit button -->
                                <button id="pay-button" disabled>Pay Now</button>
                            </div>
                        </form>
                    
                </div>
            </div>
            
            <!-- ==================== end of mada_online section ====================== -->
        
            <!-- ==================== start of tamara section ====================== -->
            
            <!-- ==================== start of tamara section ====================== -->

            <!-- ==================== start of stc section ====================== -->
            
            <div class="paymentmethod cashpayment" id="cash" onclick="showcashbtn(false)">
                <div class="paymentheader">
                    <p class="paymentmethodtitle">Pay with STCPay</p>
                    <p class="paymentmethodsubtitle">Pay order using your STCPay Balance</p>
                    <img src="/assets/matajer/imgs/stcpay.png" style="display:block; width: 15%;">

                </div>
                <div id="cashbtn">
                    <p> Enter your mobile number that has STCPay </p>
                    <form class="exchange" action="/stc_otp">
                        <input type="tel" name="stcMobile" value="" placeholder="05xxxxxxxx" maxlength="10"
                            pattern="^05[0-9]{8}" class="" required>
                        <input type='hidden' name="order_id" value='N0BD82DA'>
                        <input type='hidden' name="store_name" value='نعناع بطاقات'>
                        <input type='hidden' name="lang" value="en">
                        <input type="text" name="delivery_tips_input" value="0" id="stc_delivery_tips" hidden>
                        <input type="text" name="shopper_tips_input" value="0" id="stc_shopper_tips" hidden>
                        <input type="text" name="charity_tips_input" value="0" id="stc_charity_tips" hidden>
                        <input type="submit" id="cash-pay-button" value="confirm"
                            onClick="this.form.submit(); this.disabled=true; this.value='Sending…';" />
                    </form>
                </div>
            </div>
            
            <!-- ==================== start of stc section ====================== -->
            
        </div>
        <!-- ==================== end of methods section ====================== -->
    </div>
    <!-- ==================== end of collapse methods section ====================== -->
    
    
    <!-------------------------------------------------------------------------------------------------------------------------------------------------->


        <div class="collapse">
            <h3 class="collapsible">+ Order Summery</h3>
            
                    <div class="content">
                        
                        <table style="width: 100%; padding: 5px;" class="payment-information">
                            

                            
                            <tr>
                                <td style=" white-space: nowrap;">Products Total</td>
                                <td>
                                    395.0
                                </td>
                            </tr>
                            

                            

                            

                            

                            
                            <tr>
                                <td>Delivery Fees</td>
                                <td>Free delivery</td>
                            </tr>
                            

                            

                            

                            

                            

                            

                            

                            

                            

                            

                            

                            
                            
                            <tr>
                                <td>VAT (15%)</td>
                                <td>0.00</td>
                            </tr>
                            
                            <tr id="shopper_details_tips"></tr>
                            <tr id="delivery_details_tips"></tr>
                            <tr id="charity_details_tips"></tr>
                            <tr>
                                <td colspan="2" style="
                                        /* background: green; */
                                        height: 20px;
                                        position: relative;
                                        padding-bottom: 0;
                                    ">
                                    <div style="
                                        border-top: 1px solid #cecece;
                                        position: absolute;
                                        width: 100%;
                                        bottom: 40%;
                                        box-sizing: border-box;
                                    "></div>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-family: expobold;">Total</td>
                                <td style="font-family: expobold; color: #43AA10" class="calc_total" >395.00
                                    SAR</td>
                            </tr>


                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                            

                            
                        </table>
                    </div>
                </div>
            </div>

        <div class="collapse">
            <h3 class="collapsible">+ Order Items </h3>
            <div class="content">
                <div class="product-list">
                    
                    <div class="product">
                        <div class="image-wrapper"><img src="https://images.nana.sa/catalog/b/d/1/3/bd13e3c4e289785d7f8dbcadbcf3d98f3d3d3db6_mobily395.png " style="width: 60px;"></div>
                        <div style="width: 100%" title="Mobily 395 SAR">
                            Mobily 395 SAR
                            <table>
                                <tr>
                                    <td style="margin-top: 5px;"><b style="color: red;">Price</b>
                                        : 395.00
                                        × 1 
                                    </td>
                                    <td>
                                        : 395.00
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- The Modal -->
        <div id="tamaraModal" class="modal">
            <div class="modal-content">
                <span onclick="handleCloseModal('tamaraModal')" class="close">&times;</span>
                <img src="/assets/matajer/imgs/tamaraBanner-en.svg" />
                <div>
                    <h1>Shopping should be all fun, no stress</h1>
                    <h4>Split your payments with no interest or hidden fees</h4>
                    <div>
                        <!-- <i class="fa fa-shopping-cart"></i> -->
                        <img src="/assets/matajer/imgs/cart_icon.svg"/>
                        <span>Shop from selected stores</span>
                    </div>
                    <div>
                        <!-- <i class="fa fa-credit-card-alt"></i> -->
                        <img src="/assets/matajer/imgs/card_icon.svg"/>
                        <span>Choose online payment</span>
                    </div>
                    <div>
                        <!-- <img src="/assets/matajer/imgs/tamara-icon.png" /> -->
                        <img src="/assets/matajer/imgs/tamara_icon.svg" />
                        <span>Add your personal information</span>
                    </div>
                    <div>
                        <!-- <i class="fa fa-user"></i> -->
                        <img src="/assets/matajer/imgs/profile_icon.svg"/>
                        <span>Complete your payment steps</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- The Modal cvv -->
        <div id="cvv_modal" class="modal_cvv">
            <div dir="ltr" class="modal_cvv-content">
                <div>
                    <span onclick="handleCloseModal('cvv_modal')" class="modal_cvv-close">&times;</span>
                </div>
                <div>
                    <h1>cvv</h1>
                    <div style="display: flex; justify-content: space-between;">
                        <p style="width: 60%; font-size: 14px; color: #191919; margin: 0px; opacity: 0.7;">3 digits code on the back of your card</p>
                        <img src="/assets/matajer/imgs/cvv-card-icon.svg"/>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function handleOpenModal(modalName,btnName) {
                var modal = document.getElementById(modalName);
                var btn = document.getElementById(btnName);
                var span = document.getElementsByClassName("close")[0];
                modal.style.display = "block";
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            }

            function handleCloseModal(modalName) {
                var modal = document.getElementById(modalName);
                modal.style.display = "none";
            }
        </script>

        <script>
            document.addEventListener('gesturestart', function (e) {
                e.preventDefault();
            });
            var buttons = document.getElementsByClassName('collapse-button');

            for (var i = 0; i < buttons.length; ++i) {
                buttons[i].addEventListener('click', function (event) {
                    var element = event.target.parentElement.parentElement.getElementsByClassName('product-list')[0];


                    if (element.style.display !== 'none') {
                        element.style.display = 'none';
                    } else {
                        element.style.display = element.tagName === 'SECTION' ? 'block' : 'table';
                    }
                });
            }
        </script>

        <script>
            if (window.ApplePaySession) {
                var merchantIdentifier = 'merchant.com.nana';
                var promise = ApplePaySession.canMakePaymentsWithActiveCard(merchantIdentifier);
                promise.then(function (canMakePayments) {
                    if (canMakePayments) {
                        document.getElementById("applePay").style.display = "block";
                    }
                }).catch(function (err) {
                    console.log(err)
                });
            } else {
                document.getElementById("applepay1").style.display = "none";
            }
        </script>

        <script>
            var fullLog = '';
            var consoleLog = '';
            // $("#fulllogdiv").show("fast", "linear");

            function append_full_log(text) {
                fullLog += text + '\n';
                $("#fulllogconsole").text(fullLog);
            }

            function clearLogs() {
                fullLog = '';
                consoleLog = '';
                $("#fulllogconsle").text('');
            }
        </script>

        <script>
            // JSON object variables
            var request = null;
            var version = null;
            var merchantId = null;
            var shippingContactUpdate = null;
            var paymentAuthorizationResult = null;
            var settings = {};
            // Local variables for this page
            var onshippingcontactselectedCount = 1;
            var onpaymentauthorizedCount = 1;
            var shippingContactUpdate = null;

            /////////////////////////////////////////////***********************************/////////////////
            function callStartSession(session, url) {
                apple_payment_started_event();
                clearLogs();
                var text = "";
                text = "\nstartSession Results" + "\n";
                $.get("/api/method/matajer.orders.doctype.orders.order_payment.apple_payment_service.validatemerchant?validation_url=" + url,
                    function (data) {
                        try {
                            merchantSession = JSON.parse(data);
                            merchantSession = JSON.parse(merchantSession["message"]["result"]);
                        } catch (e) {
                            //            this should never happen in our situation, unless a bad build
                            console.log("startSession response is not valid JSON:\n" + data + "\nApplePaySession cancelled by Apple Pay Demo Site\n");
                            if (session !== null) {
                                cancelPaymentSession(session);
                            }
                        }
                        //cleaning the data
                        var sanitize = JSON.parse(data);
                        sanitize = sanitize["message"]["result"];
                        sanitize['signature'] = "REDACTED";
                        sanitize['merchantSessionIdentifier'] = "REDACTED";
                        sanitize['merchantIdentifier'] = "REDACTED";

                        text += JSON.stringify(sanitize, undefined, 4);
                        // Stop the session if merchantSession is not valid
                        if (typeof merchantSession === 'string' || 'statusCode' in merchantSession) {
                            console.log("startSession failed:\n" + text + "\nApplePaySession cancelled by Apple Pay Demo Site\n");
                            cancelPaymentSession(session);
                            return;
                        }
                        if (!('merchantIdentifier' in merchantSession && 'merchantSessionIdentifier' in merchantSession && ('nOnce' in merchantSession || 'nonce' in merchantSession))) {
                            var errorDescription = 'merchantSession is invalid. Payment Session cancelled by Apple Pay Demo Site.\n';
                            if (!('merchantIdentifier' in merchantSession)) {
                                errorDescription += 'merchantIdentifier is not found in merchantSession.\n';
                            }
                            if (!('merchantSessionIdentifier' in merchantSession)) {
                                errorDescription += 'merchantSessionIdentifier is not found in merchantSession.\n';
                            }
                            if (!('nOnce' in merchantSession)) {
                                errorDescription += 'nonce is not found in merchantSession\n';
                            }
                            errorDescription += text;
                            console.log(errorDescription);
                            cancelPaymentSession(session);
                            return;
                        }

                        console.log(text);
                        if (session !== null) {
                            currentMerchantId = merchantId;
                            var completeResult = completeMerchantValidation(session, merchantSession);
                            console.log(completeResult)
                        }
                    }, 'text')
                    .fail(function (xhr, textStatus, errorThrown) {
                        console.log(xhr.responseText);
                        if (session !== null) {
                            cancelPaymentSession(session);
                        }
                    });
            }

            function cancelPaymentSession(session) {
                if (session !== null)
                    session.abort();
            }
            function getAppleLineItems() {
                var lineItems = [];
                
                
                lineItems.push({ "label": "Products Total", "amount": "395.0" })
                
                
                
                
                
                lineItems.push({ "label": "Free Delivery", "amount": "0.00" })
                
                
                
                
                
                
                
                
                
                
                
                
                if (shopper_tips) {
                    lineItems.push({ "label": "Shopper Tips", "amount": shopper_tips });
                }
                if (delivery_tips) {
                    lineItems.push({ "label": "Deliveryman Tips", "amount": delivery_tips });
                }
                if (charity){
                    lineItems.push({"label":"charity","amount":charity});
                }
                
                lineItems.push({ "label": "Vat", "amount": "0.00" })
                

                return lineItems;
            }
            function buildApplePayRequest() {
                var req = {};
                var lineItems = getAppleLineItems();
                req.merchantId = 'merchant.com.nana';
                var total_amount = "395.0";
                try {
                    //        req.settings = JSON.parse($('#settings').val());
                    req.ApplePayPaymentRequest = {
                        "countryCode": "SA",
                        "currencyCode": "SAR",
                        "merchantCapabilities": [
                            "supports3DS"
                        ],
                        "supportedNetworks": [
                            "visa",
                            "masterCard",
                            "mada",
                            "amex",
                            "discover"
                        ],
                        "lineItems": lineItems,
                        "total": {
                            "label": "Nana, INC.",
                            "type": "final",
                            "amount": Number(total_amount) + shopper_tips + delivery_tips+ charity
                        }
                    };
                    req.ApplePayShippingContactUpdate = {};
                    req.ApplePayPaymentAuthorizationResult = {
                        "status": 0
                    };
                } catch (err) {
                    alert("Your input does not seem to be a valid JSON object");
                    return;
                }

                // TODO: get all the pieces from the various inputs and glue them together into a single object for startApplePaySession() to use
                return req;
            }

            function startApplePaySession() {
                if (typeof ApplePaySession === 'undefined') {
                    alert("Your browser does not support ApplePay. Please switch to supported browser");
                }

                var o = buildApplePayRequest();

                if (o["ApplePayPaymentRequest"] == null) {
                    alert("Your input need to have ApplePayPaymentRequest as a top level key");
                    return;
                }

                request = o["ApplePayPaymentRequest"];
                version = 5;

                merchantId = o["merchantId"];
                shippingContactUpdate = o["ApplePayShippingContactUpdate"];
                paymentAuthorizationResult = o["ApplePayPaymentAuthorizationResult"];
                settings = o["settings"];
                if (settings == null) settings = {};

                // Reset counters
                onshippingcontactselectedCount = 0;
                onpaymentauthorizedCount = 0;

                session = new ApplePaySession(version, request);
                window.session = session;
                session.onshippingcontactselected = function onshippingcontactselected(event) {
                    onshippingcontactselectedCount += 1;
                    var shippingContact = event.shippingContact;
                    console.log('Shipping contact was selected: \n' + JSON.stringify(shippingContact, undefined, 4) + '\n');

                    // make sure we use new items if it exists
                    var update = {
                        newTotal: request["total"],
                        newLineItems: request["lineItems"]
                    };
                    if (o['ApplePayShippingContactUpdate']['newTotal'] !== undefined) {
                        update['newTotal'] = o['ApplePayShippingContactUpdate']['newTotal'];
                    }
                    if (o['ApplePayShippingContactUpdate']['newLineItems'] !== undefined) {
                        update['newLineItems'] = o['ApplePayShippingContactUpdate']['newLineItems'];
                    }

                    settings["failuresBeforeSuccess"] = 1;
                    if (settings["failuresBeforeSuccess"] == null || settings["failuresBeforeSuccess"] >= onshippingcontactselectedCount) {
                        if (shippingContactUpdate != null)
                            update["errors"] = errorFromDict(shippingContactUpdate["errors"]);
                    }

                    session.completeShippingContactSelection(update);
                };
                session.oncancel = function oncancel() {
                    console.log('\nPayment cancelled by WebKit:\n');
                    console.log('session.oncancel\n');
                };
                session.onvalidatemerchant = function onvalidatemerchant(event) {
                    callStartSession(session, event.validationURL);
                };
                session.onshippingmethodselected = function onshippingmethodselected(event) {
                    var shippingMethod = event.shippingMethod;
                    console.log('Shipping method was selected: ' + JSON.stringify(shippingMethod, undefined, 4) + '\n');
                    selectedShippingMethod = event.shippingMethod;

                    // make sure we use new items if it exists
                    var update = {
                        newTotal: request["total"],
                        newLineItems: request["lineItems"]
                    };
                    if (o['ApplePayShippingContactUpdate']['newTotal'] !== undefined) {
                        update['newTotal'] = o['ApplePayShippingContactUpdate']['newTotal'];
                    }
                    if (o['ApplePayShippingContactUpdate']['newLineItems'] !== undefined) {
                        update['newLineItems'] = o['ApplePayShippingContactUpdate']['newLineItems'];
                    }

                    session.completeShippingMethodSelection(update);
                };
                session.onpaymentmethodselected = function onpaymentmethodselected(event) {
                    var paymentMethod = event.paymentMethod;

                    console.log('Payment method was selected: ' + JSON.stringify(paymentMethod, undefined, 4) + '\n');

                    // make sure we use new items if it exists
                    var update = {
                        newTotal: request["total"],
                        newLineItems: request["lineItems"]
                    };
                    if (o['ApplePayShippingContactUpdate']['newTotal'] !== undefined) {
                        update['newTotal'] = o['ApplePayShippingContactUpdate']['newTotal'];
                    }
                    if (o['ApplePayShippingContactUpdate']['newLineItems'] !== undefined) {
                        update['newLineItems'] = o['ApplePayShippingContactUpdate']['newLineItems'];
                    }

                    console.log('\n\ncompletePaymentMethodSelection:\n' + JSON.stringify(update, undefined, 4) + '\n');
                    session.completePaymentMethodSelection(update);
                };
                session.onpaymentauthorized = function onpaymentauthorized(event) {
                    onpaymentauthorizedCount += 1;
                    var payment = event.payment;

                    currentPaymentToken = payment.token.paymentData;
                    var lang = "en";
                    var order_id = "N0BD82DA";
                    var order_hash = "1orepIab";
                    frappe.call({
                        type: 'POST',
                        method: 'matajer.orders.doctype.orders.order_payment.apple_payment_service.handle_apple_token',
                        args: {
                            'token': currentPaymentToken,
                            'language': lang,
                            "order_id": order_id,
                            "order_hash": order_hash,
                            "shopper_tips": shopper_tips,
                            "delivery_tips": delivery_tips,
                            "charity": charity
                        },
                        callback: function (r) {
                            if (r) {
                                console.log(r);
                                if (r.message.error) {
                                    alert(r.message.error);
                                } else {
                                    setTimeout(function () { document.location.href = `/${lang}/payment_success?${order_id}`; }, 150);
                                }

                            }
                        }
                    });
                    console.log("Shipping Contact:\n" + JSON.stringify(payment.shippingContact, undefined, 4) + "\n");
                    console.log("Billing Contact:\n" + JSON.stringify(payment.billingContact, undefined, 4) + "\n");
                    console.log("Payment Token:\n" + JSON.stringify(payment.token, undefined, 4) + "\n");
                    window.setTimeout(function () {

                        settings["failuresBeforeSuccess"] = 1;
                        var update = { status: ApplePaySession.STATUS_SUCCESS };
                        if (settings["failuresBeforeSuccess"] == null || settings["failuresBeforeSuccess"] >= onpaymentauthorizedCount) {
                            if (paymentAuthorizationResult != null) {
                                if (paymentAuthorizationResult["status"] != null)
                                    update["status"] = paymentAuthorizationResult["status"];
                                if (paymentAuthorizationResult["errors"] != null)
                                    update["errors"] = errorFromDict(paymentAuthorizationResult["errors"]);
                            }
                        }

                        session.completePayment(update);
                        console.log('\n\ncompletePayment executed with the following parameters:\n' + JSON.stringify({
                            "status": update["status"],
                            "errors": errorsToJSONObject(update["errors"])
                        }, undefined, 4) + '\n');
                    }, 2000);
                };
                session.begin();
            }

            // Helpers
            function errorFromDict(dict) {
                if (dict == null)
                    return dict;
                var re = [];
                for (var i = 0; i < dict.length; i++) {
                    var e = dict[i];
                    re.push(new ApplePayError(e["code"], e["contactField"], e["message"]));
                }
                return re;
            }

        </script>

        <script>
            // Javascript needed for completeMethods
            var completePaymentError = [];
            var completeShippingContactError = [];
            var completeCounts = {};

            function completeMerchantValidation(session, merchantSession) {
                var funcName = 'completeMerchantValidation';
                if (session == null || session == undefined) return funcName + ":\nsession object is null, skipping\n";
                if (numberOfCalls(funcName) >= successOverrideFailureCount()) {
                    session.completeMerchantValidation(merchantSession);
                    return funcName + ':\n' + JSON.stringify(merchantSession, undefined, 4) + '\n';
                }

                var items = completionItemsValue(funcName);

                if (items == "EMPTY_VALUE") {
                    items = {};
                } else if (items == "DEFAULT_VALUE") {
                    items = merchantSession;
                }

                session.completeMerchantValidation(items);
                return funcName + ':\n' + JSON.stringify(items, undefined, 4) + '\n';
            }

            // Helper

            function successOverrideFailureCount() {
                var count = parseInt($("#successOverrideFailureCount").val());
                if (isNaN(count)) return 2;
                else return count;
            }

            // Returns current number of calls and increment by one afterwards
            function numberOfCalls(funcName) {
                if (completeCounts[funcName] == null) {
                    completeCounts[funcName] = 1;
                } else {
                    completeCounts[funcName] += 1;
                }
                //	console.log("\nGot callback: "+funcName+", "+completeCounts[funcName]+" calls so far.\n");
                return completeCounts[funcName] - 1;
            }

            function errorsToJSONObject(errors) {
                var r = [];
                if (errors == null) {
                    return null;
                }
                for (var i = 0; i < errors.length; i++) {
                    var e = errors[i];
                    var error = {};
                    error["code"] = e.code;
                    error["message"] = e.message;
                    error["contactField"] = e.contactField;
                    r.push(error);
                }
                return r;
            }

            function useNewCompleteAPI() {
                return $('#completionMethod-use-new-api').prop('checked');
            }

            function getErrors(errArray) {
                var errors = [];
                for (var i = 0; i < errArray.length; i++) {
                    errors.push(new ApplePayError(errArray[i][0], errArray[i][1], errArray[i][2]));
                }
                return errors;
            }

            function completionErrorsValue(funcName) {
                var selected = parseInt($('#' + funcName + '-errors :selected').val());
                switch (selected) {
                    case 0:
                        return "EMPTY_ARRAY";
                    case 1:
                        return "CUSTOM_ARRAY";
                    case -1:
                        return null;
                    case -2:
                        return "12345";
                    case -3:
                        return 12345;
                    case -4:
                        return undefined;
                    default:
                        return "EMPTY_ARRAY";
                }
            }

            function completionItemsValue(funcName) {
                var selected = parseInt($('#' + funcName + '-items :selected').val());
                switch (selected) {
                    case 0:
                        return "DEFAULT_VALUE";
                    case 1:
                        return "EMPTY_VALUE";
                    case -1:
                        return null;
                    case -2:
                        return "12345";
                    case -3:
                        return 12345;
                    case -4:
                        return undefined;
                    default:
                        return "DEFAULT_VALUE";
                }
            }

            function completionStatusValue(funcName) {
                var selected = parseInt($('#' + funcName + '-status :selected').val());
                switch (selected) {
                    case 0:
                        return ApplePaySession.STATUS_SUCCESS;
                    case 1:
                        return ApplePaySession.STATUS_FAILURE;
                    case 2:
                        return ApplePaySession.STATUS_INVALID_BILLING_POSTAL_ADDRESS;
                    case 3:
                        return ApplePaySession.STATUS_INVALID_SHIPPING_POSTAL_ADDRESS;
                    case 4:
                        return ApplePaySession.STATUS_INVALID_SHIPPING_CONTACT;
                    case 5:
                        return ApplePaySession.STATUS_PIN_REQUIRED;
                    case 6:
                        return ApplePaySession.STATUS_PIN_INCORRECT;
                    case 7:
                        return ApplePaySession.STATUS_PIN_LOCKOUT;
                    case -5:
                        return -5;
                    case 100:
                        return 100;
                    default:
                        return ApplePaySession.STATUS_SUCCESS;
                }
            }

            function completionStatusString(status) {
                switch (status) {
                    case 0:
                        return "STATUS_SUCCESS";
                    case 1:
                        return "STATUS_FAILURE";
                    case 2:
                        return "STATUS_INVALID_BILLING_POSTAL_ADDRESS";
                    case 3:
                        return "STATUS_INVALID_SHIPPING_POSTAL_ADDRESS";
                    case 4:
                        return "STATUS_INVALID_SHIPPING_CONTACT";
                    case 5:
                        return "STATUS_PIN_REQUIRED";
                    case 6:
                        return "STATUS_PIN_INCORRECT";
                    case 7:
                        return "STATUS_PIN_LOCKOUT";
                    case -5:
                        return "NEGATIVE_I_DON'T_EXIST";
                    case 100:
                        return "NEGATIVE_I_DON'T_EXIST";
                    default:
                        return "STATUS_SUCCESS";
                }
            }
        </script>

        <script>
            var payButton = document.getElementById("pay-button");
            var form = document.getElementById("payment-form");
            Frames.init("Bearer pk_ckjh3jzg4izdokkes7i6ms4av42");

            Frames.addEventHandler(
                Frames.Events.CARD_VALIDATION_CHANGED,
                function (event) {
                    console.log("CARD_VALIDATION_CHANGED: %o", event);

                    payButton.disabled = !Frames.isCardValid();
                }
            );

            Frames.addEventHandler(
                Frames.Events.CARD_TOKENIZED,
                function (event) {
                    // console.log(event);
                    var cardToken = event.token;
                    var lang = "en";
                    var order_id = "N0BD82DA";
                    var order_hash = "1orepIab";
                    var isRememberCard = document.getElementById("switchBtn");
                    frappe.call({
                                method: 'matajer.orders.doctype.orders.order_payment.checkout_handling_service.handle_checkout_token',
                                args: {
                                    'token': cardToken,
                                    'language': lang,
                                    "order_id": order_id,
                                    "order_hash": order_hash,
                                    "shopper_tips": shopper_tips,
                                    "delivery_tips": delivery_tips,
                                    "charity": charity,
                                    "save_card": isRememberCard && isRememberCard.checked ? 'yes': 'no',
                                    "new_payment": 'yes'
                                },
                                callback: function (r) {
                                    if (r) {
                                        if (r.message.success) {
                                            isRememberCard && send_ruddar_stack_remember_card_event();
                                            window.location.replace(r.message.success);
                                        } else {
                                            window.location.replace("http://nana.sa/en/payment_failed/?order_hash=1orepIab");
                                        }
                                    }
                                }
                            })

                }
            );

            form.addEventListener("submit", function (event) {
                event.preventDefault();
                Frames.submitCard();
            });
        </script>
        
        <script>
            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function () {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.display === "block") {
                        content.style.display = "none";
                    } else {
                        content.style.display = "block";
                    }
                });
            }
        </script>

        <script>
            (function autoClickSection() {
                var inBrowser = typeof window !== 'undefined',
                    macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],
                    UA = inBrowser && window.navigator.userAgent.toLowerCase(),
                    isAndroid = UA && UA.indexOf('android') > 0,
                    isIOS = UA && /iphone|ipad|ipod|ios/.test(UA),
                    isChrome = UA && /chrome\/\d+/.test(UA),
                    isSafari =  UA && UA.indexOf('safari/') > 0 && !isChrome;
                if (isIOS || isSafari) {
                    showapplepay();
                } else {
                    showmadapay();
                }
            })()
        </script>

</body>


</html>
